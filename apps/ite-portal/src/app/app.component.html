<h1>Submit Provider Extract</h1>
<form [formGroup]="extractForm">
  <ng-container *ngIf="extractForm.errors">
    <div class="error-message">
      <p *ngIf="extractForm.errors['coveragePeriodTooLong']">
        The coverage period must be 12 months or shorter.
      </p>
      <p *ngIf="extractForm.errors['dataExtractedWithinCoveragePeriod']">
        Data extract date must be after coverage period.
      </p>
    </div>
  </ng-container>

  <h2>Select Coverage Period</h2>
  <div class="coverage-period-selection">
    <div class="input-group">
      <label for="coverage-start">Coverage Start Date</label>
      <input
        type="date"
        name="coverage-start"
        id="coverage-start"
        formControlName="coverage_start"
      />
      <ng-container *ngIf="coverage_start.errors && coverage_start.dirty">
        <div class="error-message">
          <p *ngIf="coverage_start.errors['required']">
            Coverage start date is required.
          </p>
          <p *ngIf="coverage_start.errors['dateInFuture']">
            Coverage start date cannot in the future.
          </p>
          <p
            *ngIf="
              extractForm.errors && extractForm.errors['startDateAfterEndDate']
            "
          >
            Coverage start date must be earlier than coverage end date.
          </p>
        </div>
      </ng-container>
    </div>
    <div class="input-group">
      <label for="coverage-end">Coverage End Date</label>
      <input
        type="date"
        name="coverage-end"
        id="coverage-end"
        formControlName="coverage_end"
      />
      <ng-container *ngIf="coverage_end.errors && coverage_end.dirty">
        <div class="error-message">
          <p *ngIf="coverage_end.errors['required']">
            Coverage end date is required.
          </p>
          <p *ngIf="coverage_end.errors['dateInFuture']">
            Coverage end date cannot in the future.
          </p>
        </div>
      </ng-container>
    </div>
  </div>

  <h2>Data Extract Date</h2>
  <div class="input-group">
    <label for="extract-date">Date Data was Extracted</label>
    <input
      type="date"
      name="extract-date"
      id="extract-date"
      formControlName="extracted_on"
    />
    <span *ngIf="debug">
      Errors: {{ extractForm.get('extracted_on')!.errors | json }}</span
    >
  </div>

  <fieldset>
    <legend><h2>Transaction File Type</h2></legend>
    <input
      type="radio"
      id="transaction-group-admission"
      name="transaction_group"
      value="admission"
      formControlName="transaction_group"
    />
    <label for="transaction-group-admission">Admission</label>
    <br />
    <input
      type="radio"
      id="transaction-group-discharge"
      name="transaction_group"
      value="discharge"
      formControlName="transaction_group"
    />
    <label for="transaction-group-discharge">Discharge</label>
    <!-- <input
      type="radio"
      id="transaction-group-discharge"
      name="transaction_group"
      value="update"
      formControlName="transaction_group"
    />
    <label for="transaction-group-discharge">Update</label> -->
    <span *ngIf="debug">
      Errors: {{ extractForm.get('transaction_group')!.errors | json }}</span
    >
  </fieldset>
  <div class="input-group">
    <label for="file-upload"><h2>Upload Extract</h2></label>
    <input
      #fileInput
      type="file"
      name="file-upload"
      id="file-upload"
      accept="text/csv"
      (change)="fileSelected(fileInput.files)"
    />
  </div>
</form>

<button
  [disabled]="extractForm.status === 'INVALID'"
  type="button"
  (click)="sendData()"
>
  Send Data
</button>

<div *ngIf="debug" class="debug-container">
  <div class="column">
    <h2>Form Value:</h2>
    <pre
      >{{ extractForm.value | json }}
    </pre>
  </div>
  <div class="column">
    <h2>Form Errors:</h2>
    <pre
      >{{ extractForm.errors | json }} {{ extractForm.status }}
    </pre>
  </div>
</div>

<button class="debug-toggle" type="button" (click)="debug = !debug">
  Debugging {{ debug ? '❌' : '✅' }}
</button>
