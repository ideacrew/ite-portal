<h1>Submission Summary</h1>

<ng-container *ngIf="submission$ | async as submission">
  <h2>File Information</h2>
  <div class="file-info">
    <span>Provider: </span> <span>{{ providerName$ | async }}</span>
  </div>
  <div class="file-info">
    <span>Reporting Period: </span>
    <span
      >{{ submission.coverage_start | date }} to
      {{ submission.coverage_end | date }}</span
    >
  </div>
  <div class="file-info">
    <span>File Name: </span> <span>{{ submission.file_name }} </span>
  </div>
  <div class="file-info">
    <span>Submission Date: </span>
    <span>{{ submission.created_at | date }} </span>
  </div>

  <div class="summary-with-chart">
    <div class="summary">
      <h2>Validation Summary</h2>
      <div class="file-info">
        <span>Passing Records</span>
        <dbh-record-count
          [records]="submission.records"
          status="Pass"
        ></dbh-record-count>
      </div>
      <div class="file-info">
        <span>Failing Records </span>
        <dbh-record-count
          [records]="submission.records"
          status="Fail"
        ></dbh-record-count>
      </div>
      <div class="file-info">
        <span>Total Records Submitted </span>
        <span>{{ submission.records.length }} </span>
      </div>
    </div>
    <div
      class="chart"
      [style.--pass]="
        (submission.records | recordCount: 'Pass':'relative') + '%'
      "
      [style.--fail]="
        (submission.records | recordCount: 'Fail':'relative') + '%'
      "
    ></div>
  </div>

  <p>Pass: Records with (a) warning(s) only or no errors.</p>
  <p>Fail: Records with at least one fatal or critical error.</p>

  <h2>Error Summary</h2>
  <div class="file-info">
    <span>Fatal errors</span>
    <span>{{ submission.records | errorCount: 'Fatal' }} </span>
  </div>
  <div class="file-info">
    <span>Critical errors</span>
    <span>{{ submission.records | errorCount: 'Critical' }} </span>
  </div>
  <div class="file-info">
    <span>Warnings</span>
    <span>{{ submission.records | errorCount: 'Warning' }} </span>
  </div>

  <h2>Issues by Category</h2>
  <dbh-errors-by-category
    [records]="submission.records"
  ></dbh-errors-by-category>
  <p>Fatal error: an error in a key field</p>
  <p>Critical error: an error in a required field</p>
  <p>Warning: an error in an optional field</p>

  <h2>Issues by Data Field</h2>
  <h3>Fatal Errors (Key Fields)</h3>
  <!-- <dbh-issues-by-data-field
    [issuesByDataField]="submission.records | recordsWithErrorType: 'Fatal'"
  ></dbh-issues-by-data-field> -->
</ng-container>
