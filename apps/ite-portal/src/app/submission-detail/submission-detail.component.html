<h1>Submission Summary</h1>

<!-- <pre>
  {{ submissionV2$ | async | json }}
</pre> -->

<ng-container *ngIf="submission$ | async as submission">
  <h2>File Information</h2>
  <div class="file-info">
    <span>Provider: </span> <span>{{ providerName$ | async }}</span>
  </div>
  <div class="file-info">
    <span>Reporting Period: </span>
    <span
      >{{ submission.coverage_start | slice: 0:10 | date }} to
      {{ submission.coverage_end | slice: 0:10 | date }}</span
    >
  </div>
  <div class="file-info">
    <span>File Name: </span> <span>{{ submission.file_name }} </span>
  </div>
  <div class="file-info">
    <span>Submission Date: </span>
    <span>{{ submission.created_at | slice: 0:10 | date }} </span>
  </div>

  <div class="summary">
    <h2>Validation Breakdown</h2>
    <h3>Records Submitted: {{ submission.records.length }}</h3>
    <div
      class="chart"
      [style.--pass]="
        (submission.records | recordCount: 'Pass':'relative') + '%'
      "
      [style.--fail]="
        (submission.records | recordCount: 'Fail':'relative') + '%'
      "
    ></div>
    <div class="legend">
      <div class="fail">
        <span class="color-block"></span>
        <span>Fail {{ submission.records | recordCount: 'Fail' }}</span>
        <span>{{ submission.records | recordCount: 'Fail':'relative' }}%</span>
      </div>
      <div class="pass">
        <span class="color-block"></span>
        <span>Pass {{ submission.records | recordCount: 'Pass' }}</span>
        <span>{{ submission.records | recordCount: 'Pass':'relative' }}%</span>
      </div>
    </div>
    <details class="definitions">
      <summary>Definitions</summary>
      <p>Pass: Records with (a) warning(s) only or no errors.</p>
      <p>Fail: Records with at least one fatal or critical error.</p>
    </details>
  </div>
</ng-container>

<ng-container *ngIf="submissionV2$ | async as submission">
  <h2>Issues by Record</h2>
  <table>
    <thead>
      <tr>
        <th>Record ID</th>
        <th>Pass/Fail</th>
        <th>Fatal Errors</th>
        <th>Critical Errors</th>
        <th>Warnings</th>
      </tr>
    </thead>
    <tbody>
      <dbh-record-list
        *ngFor="let record of submission.records | recordSort"
        [record]="record"
      ></dbh-record-list>
    </tbody>
  </table>
</ng-container>
